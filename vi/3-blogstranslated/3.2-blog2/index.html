<!doctype html><html lang=vi class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=description content><meta name=author content="thienlh@thienlu.com"><link rel=icon href=../../../images/favicon.png type=image/png><title>Blog 2 :: Báo cáo thực tập</title>
<link href=../../../css/nucleus.css?1765261581 rel=stylesheet><link href=../../../css/fontawesome-all.min.css?1765261581 rel=stylesheet><link href=../../../css/hybrid.css?1765261581 rel=stylesheet><link href=../../../css/featherlight.min.css?1765261581 rel=stylesheet><link href=../../../css/perfect-scrollbar.min.css?1765261581 rel=stylesheet><link href=../../../css/auto-complete.css?1765261581 rel=stylesheet><link href=../../../css/atom-one-dark-reasonable.css?1765261581 rel=stylesheet><link href=../../../css/theme.css?1765261581 rel=stylesheet><link href=../../../css/hugo-theme.css?1765261581 rel=stylesheet><link href=../../../css/theme-workshop.css?1765261581 rel=stylesheet><script src=../../../js/jquery-3.3.1.min.js?1765261581></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=../../../vi/3-blogstranslated/3.2-blog2/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=../../../><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=../../../js/lunr.min.js?1765261581></script><script type=text/javascript src=../../../js/auto-complete.js?1765261581></script><script type=text/javascript>var baseurl="https://thienluhoan.github.io/workshop-template//vi"</script><script type=text/javascript src=../../../js/search.js?1765261581></script></div><div class=highlightable><ul class=topics><li data-nav-id=/vi/1-worklog/ title="Nhật ký công việc" class=dd-item><a href=../../../vi/1-worklog/><b>1. </b>Nhật ký công việc
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/1-worklog/1.1-week1/ title="Worklog Tuần 1" class=dd-item><a href=../../../vi/1-worklog/1.1-week1/><b>1.1. </b>Worklog Tuần 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.2-week2/ title="Worklog Tuần 2" class=dd-item><a href=../../../vi/1-worklog/1.2-week2/><b>1.2. </b>Worklog Tuần 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.3-week3/ title="Worklog Tuần 3" class=dd-item><a href=../../../vi/1-worklog/1.3-week3/><b>1.3. </b>Worklog Tuần 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.4-week4/ title="Worklog Tuần 4" class=dd-item><a href=../../../vi/1-worklog/1.4-week4/><b>1.4. </b>Worklog Tuần 4
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.5-week5/ title="Worklog Tuần 5" class=dd-item><a href=../../../vi/1-worklog/1.5-week5/><b>1.5. </b>Worklog Tuần 5
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.6-week6/ title="Worklog Tuần 6" class=dd-item><a href=../../../vi/1-worklog/1.6-week6/><b>1.6. </b>Worklog Tuần 6
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.11-week11/ title="Worklog Tuần 11" class=dd-item><a href=../../../vi/1-worklog/1.11-week11/><b>1.11. </b>Worklog Tuần 11
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.10-week10/ title="Worklog Tuần 10" class=dd-item><a href=../../../vi/1-worklog/1.10-week10/><b>1.10. </b>Worklog Tuần 10
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.8-week8/ title="Worklog Tuần 8" class=dd-item><a href=../../../vi/1-worklog/1.8-week8/><b>1.8. </b>Worklog Tuần 8
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.9-week9/ title="Worklog Tuần 8" class=dd-item><a href=../../../vi/1-worklog/1.9-week9/><b>1.8. </b>Worklog Tuần 8
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.7-week7/ title="Worklog Tuần 7" class=dd-item><a href=../../../vi/1-worklog/1.7-week7/><b>1.7. </b>Worklog Tuần 7
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.12-week12/ title="Worklog Tuần 12" class=dd-item><a href=../../../vi/1-worklog/1.12-week12/><b>1.12 </b>Worklog Tuần 12
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/2-proposal/ title="Bản đề xuất" class=dd-item><a href=../../../vi/2-proposal/><b>2. </b>Bản đề xuất
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/ title="Các bài blogs đã dịch" class="dd-item
parent"><a href=../../../vi/3-blogstranslated/><b>3. </b>Các bài blogs đã dịch
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/3-blogstranslated/3.1-blog1/ title="Blog 1" class=dd-item><a href=../../../vi/3-blogstranslated/3.1-blog1/><b>3.1. </b>Blog 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.2-blog2/ title="Blog 2" class="dd-item
active"><a href=../../../vi/3-blogstranslated/3.2-blog2/><b>3.2. </b>Blog 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.3-blog3/ title="Blog 3" class=dd-item><a href=../../../vi/3-blogstranslated/3.3-blog3/><b>3.3. </b>Blog 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.4-blog4/ title="Blog 4" class=dd-item><a href=../../../vi/3-blogstranslated/3.4-blog4/><b>3.4. </b>Blog 4
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.5-blog5/ title="Blog 5" class=dd-item><a href=../../../vi/3-blogstranslated/3.5-blog5/><b>3.6. </b>Blog 5
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.6-blog6/ title="Blog 6" class=dd-item><a href=../../../vi/3-blogstranslated/3.6-blog6/><b>3.6. </b>Blog 6
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/4-eventparticipated/ title="Các events đã tham gia" class=dd-item><a href=../../../vi/4-eventparticipated/><b>4. </b>Các events đã tham gia
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/4-eventparticipated/4.1-event1/ title="Event 1" class=dd-item><a href=../../../vi/4-eventparticipated/4.1-event1/><b>4.1. </b>Event 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.2-event2/ title="Event 2" class=dd-item><a href=../../../vi/4-eventparticipated/4.2-event2/><b>4.2. </b>Event 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.3-event3/ title="Event 3" class=dd-item><a href=../../../vi/4-eventparticipated/4.3-event3/><b>4.3. </b>Event 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.4-event4/ title="Event 4" class=dd-item><a href=../../../vi/4-eventparticipated/4.4-event4/><b>4.4. </b>Event 4
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.5-event5/ title="Event 5" class=dd-item><a href=../../../vi/4-eventparticipated/4.5-event5/><b>4.5. </b>Event 5
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/5-workshop/ title=Workshop class=dd-item><a href=../../../vi/5-workshop/><b>5. </b>Workshop
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/5-workshop/5.1-workshop-overview/ title=Introduction class=dd-item><a href=../../../vi/5-workshop/5.1-workshop-overview/><b>5.1. </b>Introduction
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.2-prerequiste/ title=Prerequiste class=dd-item><a href=../../../vi/5-workshop/5.2-prerequiste/><b>5.2. </b>Prerequiste
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.3-s3-vpc/ title="Thiết lập cơ sở hạ tầng mạng" class=dd-item><a href=../../../vi/5-workshop/5.3-s3-vpc/><b>5.3. </b>Thiết lập cơ sở hạ tầng mạng
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/5-workshop/5.3-s3-vpc/5.3.1-create-gwe/ title="Tạo VPC và Mạng con" class=dd-item><a href=../../../vi/5-workshop/5.3-s3-vpc/5.3.1-create-gwe/><b>5.3.1 </b>Tạo VPC và Mạng con
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.3-s3-vpc/5.3.2-test-gwe/ title="Cấu hình Internet & NAT Gateway" class=dd-item><a href=../../../vi/5-workshop/5.3-s3-vpc/5.3.2-test-gwe/><b>5.3.2 </b>Cấu hình Internet & NAT Gateway
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/5-workshop/5.4-s3-onprem/ title="Data Layer Deployment" class=dd-item><a href=../../../vi/5-workshop/5.4-s3-onprem/><b>5.4. </b>Data Layer Deployment
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/5-workshop/5.4-s3-onprem/5.4.1-prepare/ title="Thiết lập Nhóm bảo mật" class=dd-item><a href=../../../vi/5-workshop/5.4-s3-onprem/5.4.1-prepare/><b>5.4.1 </b>Thiết lập Nhóm bảo mật
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.4-s3-onprem/5.4.2-create-interface-enpoint/ title="Initialize Amazon RDS" class=dd-item><a href=../../../vi/5-workshop/5.4-s3-onprem/5.4.2-create-interface-enpoint/><b>5.4.2 </b>Initialize Amazon RDS
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.4-s3-onprem/5.4.3-test-endpoint/ title="Initialize ElastiCache Redis" class=dd-item><a href=../../../vi/5-workshop/5.4-s3-onprem/5.4.3-test-endpoint/><b>5.4.3 </b>Initialize ElastiCache Redis
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/5-workshop/5.5-policy/ title="Triển khai ứng dụng" class=dd-item><a href=../../../vi/5-workshop/5.5-policy/><b>5.5. </b>Triển khai ứng dụng
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/5-workshop/5.5-policy/5.5.2-initialize-elastic-beanstalk/ title="Initialize Elastic Beanstalk" class=dd-item><a href=../../../vi/5-workshop/5.5-policy/5.5.2-initialize-elastic-beanstalk/><b>5.5.2 </b>Initialize Elastic Beanstalk
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.5-policy/5.5.1-package-with-docker/ title="Package with Docker" class=dd-item><a href=../../../vi/5-workshop/5.5-policy/5.5.1-package-with-docker/><b>5.5.1 </b>Package with Docker
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/5-workshop/5.6-monitoringoperations/ title="Monitoring & Operations" class=dd-item><a href=../../../vi/5-workshop/5.6-monitoringoperations/><b>5.6. </b>Monitoring & Operations
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.7-clean-up/ title="Dọn Dẹp" class=dd-item><a href=../../../vi/5-workshop/5.7-clean-up/><b>5.7. </b>Dọn Dẹp
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/6-self-evaluation/ title="Tự đánh giá" class=dd-item><a href=../../../vi/6-self-evaluation/><b>6. </b>Tự đánh giá
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/7-feedback/ title="Chia sẻ, đóng góp ý kiến" class=dd-item><a href=../../../vi/7-feedback/><b>7. </b>Chia sẻ, đóng góp ý kiến
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://thienluhoan.github.io/workshop-template/3-blogstranslated/3.2-blog2/>English</option><option id=vi value=https://thienluhoan.github.io/workshop-template/vi/3-blogstranslated/3.2-blog2/ selected>Tiếng Việt</option></select><svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><span id=lastUpdated style=color:orange></span>
</i><script>const today=new Date,formattedDate=today.toLocaleDateString("en-GB");document.getElementById("lastUpdated").textContent=formattedDate</script></left><left><br><br><b>Team</b><br><i><a href=https://www.facebook.com/groups/660548818043427 style=color:orange>First Cloud Journey</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=../../../vi/>Báo cáo thực tập</a> > <a href=../../../vi/3-blogstranslated/>Các bài blogs đã dịch</a> > Blog 2</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#cải-thiện-hiệu-suất>Cải thiện hiệu suất</a></li><li><a href=#tối-ưu-hóa-với-thống-kê-ở-cấp-bảng-table-level-statistics>Tối ưu hóa với thống kê ở cấp bảng (table-level statistics)</a></li><li><a href=#cải-thiện-hiệu-suất-với-aws-glue-data-catalog-column-statistics>Cải thiện hiệu suất với AWS Glue Data Catalog column statistics</a><ul><li><a href=#không-sử-dụng-statistics>Không sử dụng Statistics</a></li><li><a href=#sử-dụng-statistics>Sử dụng Statistics</a></li></ul></li><li><a href=#tối-ưu-hóa-bằng-cách-viết-lại-truy-vấn>Tối ưu hóa bằng cách viết lại truy vấn</a></li><li><a href=#bloom-filter-cho-các-cột-phân-vùng>Bloom filter cho các cột phân vùng</a><ul><li><a href=#without-bloom-filter-support-on-partition-columns>Without bloom filter support on partition columns</a></li><li><a href=#with-bloom-filter-support-on-partition-columns>With bloom filter support on partition columns</a></li></ul></li><li><a href=#kết-luận>Kết luận</a></li><li><a href=#về-các-tác-giả>Về các Tác giả</a><ul><li><a href=#kalaiselvi-kamaraj>Kalaiselvi Kamaraj</a></li><li><a href=#mark-lyons>Mark Lyons</a></li><li><a href=#asser-moustafa>Asser Moustafa</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Blog 2</h1><h1 id=tăng-tốc-các-truy-vấn-amazon-redshift-data-lake-với-aws-glue-data-catalog-column-statistics>Tăng tốc các truy vấn Amazon Redshift Data Lake với AWS Glue Data Catalog Column Statistics</h1><p>by Kalaiselvi Kamaraj, Asser Moustafa, and Mark Lyons | on 01 OCT 2024 in | Amazon Redshift | Amazon Simple Storage Service (S3) | Analytics, Announcements | AWS Big Data | AWS Glue | Best Practices Permalink</p><p>Amazon Redshift cho phép bạn truy vấn và truy xuất dữ liệu có cấu trúc và bán cấu trúc từ các open format files trong Amazon S3 data lake mà không cần phải load dữ liệu vào các bảng Amazon Redshift. Amazon Redshift mở rộng SQL capabilities tới data lake, cho phép bạn thực hiện các analytical queries. Redshift hỗ trợ nhiều định dạng dữ liệu bảng khác nhau như CSV, JSON, Parquet, ORC và các định dạng bảng mở như Apache Hudi, Linux Foundation Delta Lake, và Apache Iceberg.</p><p>Bạn tạo Redshift external tables bằng cách định nghĩa cấu trúc cho các file, S3 location của file và đăng ký chúng như bảng trong external data catalog. External data catalog có thể là AWS Glue Data Catalog, data catalog đi kèm với Amazon Athena, hoặc Apache Hive metastore của bạn.</p><p>Trong năm vừa qua, Amazon Redshift đã thêm một số performance optimizations cho data lake queries trên nhiều khía cạnh của query engine như rewrite, planning, scan execution và sử dụng AWS Glue Data Catalog column statistics. Để đạt performance tốt nhất cho các truy vấn data lake với Redshift, bạn có thể sử dụng column statistics của AWS Glue Data Catalog để thu thập thống kê trên các bảng Data Lake. Đối với Amazon Redshift Serverless instances, bạn sẽ thấy scan performance cải thiện nhờ parallel processing tăng lên của các file S3 và điều này diễn ra tự động dựa trên RPUs sử dụng.</p><p>Trong bài viết này, chúng tôi nhấn mạnh các cải thiện về hiệu suất quan sát được bằng cách sử dụng industry standard TPC-DS benchmarks. Tổng execution time của TPC-DS 3 TB benchmark cải thiện gấp 3 lần. Một số truy vấn trong benchmark đạt tốc độ nhanh hơn gấp 12 lần.</p><h2 id=cải-thiện-hiệu-suất>Cải thiện hiệu suất</h2><p>Trong năm vừa qua, đã có nhiều performance optimizations được thực hiện để cải thiện hiệu suất của các data lake queries, bao gồm:</p><ul><li>Sử dụng AWS Glue Data Catalog column statistics và tuning Redshift optimizer để cải thiện chất lượng query plans.</li><li>Sử dụng bloom filters cho các partition columns.</li><li>Cải thiện scan efficiency cho Amazon Redshift Serverless instances thông qua tăng parallel processing của các file.</li><li>Áp dụng các novel query rewrite rules để merge các scans tương tự.</li><li>Truy xuất metadata nhanh hơn từ AWS Glue Data Catalog.</li></ul><p>Để hiểu rõ performance gains, chúng tôi đã kiểm tra hiệu suất bằng industry-standard TPC-DS benchmark sử dụng 3 TB data sets và queries, đại diện cho các customer use cases khác nhau. Hiệu suất được kiểm tra trên Redshift serverless data warehouse với 128 RPU. Trong thử nghiệm, dataset được lưu trữ trên Amazon S3 ở định dạng Parquet, và AWS Glue Data Catalog được sử dụng để quản lý các external databases và tables. Các fact tables được partition theo date column, mỗi bảng gồm khoảng 2,000 partitions. Tất cả các bảng đều có row count table property, numRows, được thiết lập theo spectrum query performance guidelines.</p><p>Chúng tôi thực hiện một baseline run trên Redshift patch version (patch 172) của năm trước. Sau đó, chạy tất cả các truy vấn TPC-DS trên latest patch version (patch 180), bao gồm tất cả performance optimizations được thêm trong năm qua. Tiếp đó, sử dụng AWS Glue Data Catalog column statistics để tính toán thống kê cho tất cả bảng và đo lường cải thiện hiệu suất khi có column statistics.</p><p>Phân tích cho thấy TPC-DS 3TB Parquet benchmark đạt được performance gains đáng kể nhờ các tối ưu hóa này. Cụ thể, partitioned Parquet với các tối ưu hóa mới nhất đạt runtime nhanh hơn 2x so với triển khai trước đó. Việc bật AWS Glue Data Catalog column statistics tiếp tục cải thiện hiệu suất gấp 3 lần so với năm trước. Đồ thị dưới đây minh họa runtime improvements cho toàn bộ benchmark (tất cả truy vấn TPC-DS) trong năm qua, bao gồm boost bổ sung nhờ sử dụng AWS Glue Data Catalog column statistics.</p><p><img alt="Hình 1: Cải thiện tổng thời gian thực thi (total runtime) của TPC-DS 3T workload" src=../../../images/3-BlogsTranslated/3.2-Blog2/figure1-total-runtime-improvements.png></p><p><em>Hình 1: Cải thiện tổng thời gian thực thi (total runtime) của TPC-DS 3T workload</em></p><p>Đồ thị dưới đây trình bày các top queries từ TPC-DS benchmark có cải thiện hiệu suất lớn nhất trong năm qua, với và không có AWS Glue Data Catalog column statistics. Bạn có thể thấy rằng hiệu suất cải thiện đáng kể khi có statistics trên AWS Glue Data Catalog (để biết chi tiết cách thu thập statistics cho các Data Lake tables, vui lòng tham khảo optimizing query performance using AWS Glue Data Catalog column statistics). Cụ thể, các multi-join queries sẽ hưởng lợi nhiều nhất từ AWS Glue Data Catalog column statistics, bởi vì optimizer sử dụng statistics để chọn join order và distribution strategy phù hợp.</p><p><img alt="Hình 2: Tăng tốc (Speed-up) trong các truy vấn TPC-DS" src=../../../images/3-BlogsTranslated/3.2-Blog2/figure2-speedup-queries.png></p><p><em>Hình 2: Tăng tốc (Speed-up) trong các truy vấn TPC-DS</em></p><p>Hãy cùng thảo luận một số optimizations đã góp phần cải thiện query performance.</p><h2 id=tối-ưu-hóa-với-thống-kê-ở-cấp-bảng-table-level-statistics>Tối ưu hóa với thống kê ở cấp bảng (table-level statistics)</h2><p>Amazon Redshift được thiết kế để xử lý các thách thức large-scale data với speed và cost-efficiency vượt trội. Massively parallel processing (MPP) query engine, AI-powered query optimizer, auto-scaling capabilities và các tính năng tiên tiến khác giúp Redshift xuất sắc trong việc searching, aggregating, và transforming petabytes of data.</p><p>Tuy nhiên, ngay cả những hệ thống mạnh nhất cũng có thể gặp phải performance degradation nếu gặp phải các anti-patterns như table statistics cực kỳ inaccurate, ví dụ như row count metadata.</p><p>Thiếu metadata quan trọng này, query optimizer của Redshift có thể bị hạn chế trong số lượng các possible optimizations, đặc biệt là các tối ưu liên quan đến data distribution trong quá trình query execution. Điều này có thể ảnh hưởng đáng kể đến overall query performance.</p><p>Để minh họa, hãy xem xét một truy vấn đơn giản liên quan đến inner join giữa một large table với hàng tỷ rows và một small table chỉ có vài trăm nghìn rows.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span> small_table.sellerid, <span style=color:#66d9ef>sum</span>(large_table.qtysold)
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> large_table, small_table
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> large_table.salesid <span style=color:#f92672>=</span> small_table.listid
</span></span><span style=display:flex><span> <span style=color:#66d9ef>and</span> small_table.listtime <span style=color:#f92672>&gt;</span> <span style=color:#e6db74>&#39;2023-12-01&#39;</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>and</span> large_table.saletime <span style=color:#f92672>&gt;</span> <span style=color:#e6db74>&#39;2023-12-01&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>group</span> <span style=color:#66d9ef>by</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>Nếu được executed as-is, với large table nằm ở right-hand side của join, truy vấn sẽ dẫn đến sub-optimal performance. Điều này là do large table sẽ cần được distributed (broadcast) đến tất cả các Redshift compute nodes để thực hiện inner join với small table, như minh họa trong diagram dưới đây.</p><p><img alt="Hình 3: Inaccurate table statistics dẫn đến limited optimizations và lượng lớn dữ liệu phải broadcast giữa các compute nodes cho một simple inner join" src=../../../images/3-BlogsTranslated/3.2-Blog2/figure3-inaccurate-statistics.png></p><p><em>Hình 3: Inaccurate table statistics dẫn đến limited optimizations và lượng lớn dữ liệu phải broadcast giữa các compute nodes cho một simple inner join</em></p><p>Bây giờ, hãy xem xét một scenario trong đó table statistics, chẳng hạn như row count, là accurate. Điều này cho phép Amazon Redshift query optimizer đưa ra các quyết định informed hơn, chẳng hạn như xác định optimal join order. Trong trường hợp này, optimizer sẽ ngay lập tức rewrite truy vấn để large table nằm ở left-hand side của inner join, sao cho small table là bảng được broadcast đến các Redshift compute nodes, như minh họa trong diagram dưới đây.</p><p><img alt="Hình 4: Accurate table statistics dẫn đến high degree of optimizations và rất ít dữ liệu được broadcast giữa các compute nodes cho một simple inner join" src=../../../images/3-BlogsTranslated/3.2-Blog2/figure4-accurate-statistics.png></p><p><em>Hình 4: Accurate table statistics dẫn đến high degree of optimizations và rất ít dữ liệu được broadcast giữa các compute nodes cho một simple inner join</em></p><p>May mắn thay, Amazon Redshift tự động duy trì accurate table statistics cho các local tables bằng cách chạy lệnh ANALYZE ở chế độ nền. Tuy nhiên, đối với các external tables (data lake tables), việc sử dụng AWS Glue Data Catalog column statistics được khuyến nghị khi làm việc với Amazon Redshift, như chúng tôi sẽ thảo luận trong phần tiếp theo. Để biết thêm thông tin tổng quát về optimizing queries trong Amazon Redshift, vui lòng tham khảo tài liệu về factors affecting query performance, data redistribution, và Amazon Redshift best practices for designing queries.</p><h2 id=cải-thiện-hiệu-suất-với-aws-glue-data-catalog-column-statistics>Cải thiện hiệu suất với AWS Glue Data Catalog column statistics</h2><p>AWS Glue Data Catalog có một tính năng để compute column level statistics cho các Amazon S3 backed external tables. AWS Glue Data Catalog có thể tính toán các column level statistics như NDV, Number of Nulls, Min/Max, và Avg. column width cho các cột mà không cần các data pipelines bổ sung.</p><p>Amazon Redshift cost-based optimizer sử dụng các statistics này để tạo ra các query plans có chất lượng tốt hơn. Bên cạnh việc sử dụng statistics, chúng tôi cũng thực hiện một số cải tiến trong cardinality estimations và cost tuning để có được các high quality query plans, từ đó cải thiện query performance.</p><p>Với TPC-DS 3TB dataset, tổng query execution time đã cải thiện 40% khi sử dụng AWS Glue Data Catalog column statistics. Một số TPC-DS queries riêng lẻ đã cải thiện lên đến 5x về thời gian thực thi. Một số truy vấn có tác động lớn đến thời gian thực thi bao gồm Q85, Q64, Q75, Q78, Q94, Q16, Q04, Q24, và Q11.</p><p>Chúng tôi sẽ đi qua một ví dụ, nơi cost-based optimizer tạo ra query plan tốt hơn nhờ statistics và cách nó cải thiện execution time.</p><p>Hãy xem xét phiên bản simpler của TPC-DS Q64 dưới đây để minh họa query plan differences khi có statistics.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span> i_product_name product_name
</span></span><span style=display:flex><span>,i_item_sk item_sk
</span></span><span style=display:flex><span>,ad1.ca_street_number b_street_number
</span></span><span style=display:flex><span>,ad1.ca_street_name b_street_name
</span></span><span style=display:flex><span>,ad1.ca_city b_city
</span></span><span style=display:flex><span>,ad1.ca_zip b_zip
</span></span><span style=display:flex><span>,d1.d_year <span style=color:#66d9ef>as</span> syear
</span></span><span style=display:flex><span>,<span style=color:#66d9ef>count</span>(<span style=color:#f92672>*</span>) cnt
</span></span><span style=display:flex><span>,<span style=color:#66d9ef>sum</span>(ss_wholesale_cost) s1
</span></span><span style=display:flex><span>,<span style=color:#66d9ef>sum</span>(ss_list_price) s2
</span></span><span style=display:flex><span>,<span style=color:#66d9ef>sum</span>(ss_coupon_amt) s3
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span>   tpcds_3t_alls3_pp_ext.store_sales
</span></span><span style=display:flex><span>,tpcds_3t_alls3_pp_ext.store_returns
</span></span><span style=display:flex><span>,tpcds_3t_alls3_pp_ext.date_dim d1
</span></span><span style=display:flex><span>,tpcds_3t_alls3_pp_ext.customer
</span></span><span style=display:flex><span>,tpcds_3t_alls3_pp_ext.customer_address ad1
</span></span><span style=display:flex><span>,tpcds_3t_alls3_pp_ext.item
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span>
</span></span><span style=display:flex><span>ss_sold_date_sk <span style=color:#f92672>=</span> d1.d_date_sk <span style=color:#66d9ef>AND</span>
</span></span><span style=display:flex><span>ss_customer_sk <span style=color:#f92672>=</span> c_customer_sk <span style=color:#66d9ef>AND</span>
</span></span><span style=display:flex><span>ss_addr_sk <span style=color:#f92672>=</span> ad1.ca_address_sk <span style=color:#66d9ef>and</span>
</span></span><span style=display:flex><span>ss_item_sk <span style=color:#f92672>=</span> i_item_sk <span style=color:#66d9ef>and</span>
</span></span><span style=display:flex><span>ss_item_sk <span style=color:#f92672>=</span> sr_item_sk <span style=color:#66d9ef>and</span>
</span></span><span style=display:flex><span>ss_ticket_number <span style=color:#f92672>=</span> sr_ticket_number <span style=color:#66d9ef>and</span>
</span></span><span style=display:flex><span>i_color <span style=color:#66d9ef>in</span> (<span style=color:#e6db74>&#39;firebrick&#39;</span>,<span style=color:#e6db74>&#39;papaya&#39;</span>,<span style=color:#e6db74>&#39;orange&#39;</span>,<span style=color:#e6db74>&#39;cream&#39;</span>,<span style=color:#e6db74>&#39;turquoise&#39;</span>,<span style=color:#e6db74>&#39;deep&#39;</span>) <span style=color:#66d9ef>and</span>
</span></span><span style=display:flex><span>i_current_price <span style=color:#66d9ef>between</span> <span style=color:#ae81ff>42</span> <span style=color:#66d9ef>and</span> <span style=color:#ae81ff>42</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>10</span> <span style=color:#66d9ef>and</span>
</span></span><span style=display:flex><span>i_current_price <span style=color:#66d9ef>between</span> <span style=color:#ae81ff>42</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>and</span> <span style=color:#ae81ff>42</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>15</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>group</span> <span style=color:#66d9ef>by</span> i_product_name
</span></span><span style=display:flex><span>,i_item_sk
</span></span><span style=display:flex><span>,ad1.ca_street_number
</span></span><span style=display:flex><span>,ad1.ca_street_name
</span></span><span style=display:flex><span>,ad1.ca_city
</span></span><span style=display:flex><span>,ad1.ca_zip
</span></span><span style=display:flex><span>,d1.d_year
</span></span></code></pre></div><h3 id=không-sử-dụng-statistics>Không sử dụng Statistics</h3><p>Hình dưới đây thể hiện logical query plan của Q64. Bạn có thể nhận thấy rằng cardinality estimation của các joins không chính xác. Với cardinalities không chính xác, optimizer sẽ tạo ra một query plan không tối ưu, dẫn đến execution time cao hơn.</p><p><img alt="Hình 5: Logical query plan của Q64 khi không sử dụng statistics" src=../../../images/3-BlogsTranslated/3.2-Blog2/figure5-q64-without-statistics.png></p><p><em>Hình 5: Logical query plan của Q64 khi không sử dụng statistics</em></p><h3 id=sử-dụng-statistics>Sử dụng Statistics</h3><p>Hình dưới đây thể hiện logical query plan sau khi sử dụng AWS Glue Data Catalog column statistics. Dựa trên các thay đổi được highlight, bạn có thể thấy rằng cardinality estimations của JOIN đã được cải thiện đáng kể, giúp optimizer chọn được join order và join strategy tốt hơn (broadcast DS_BCAST_INNER so với distribute DS_DIST_BOTH). Việc hoán đổi bảng customer_address và customer từ inner sang outer table và chuyển join strategies sang distribute có tác động lớn vì điều này giảm data movement giữa các nodes và tránh spilling từ hash table.</p><p><img alt="Hình 6: Logical query plan của Q64 sau khi sử dụng AWS Glue Data Catalog column statistics" src=../../../images/3-BlogsTranslated/3.2-Blog2/figure6-q64-with-statistics.png></p><p><em>Hình 6: Logical query plan của Q64 sau khi sử dụng AWS Glue Data Catalog column statistics</em></p><p>Sự thay đổi trong query plan này đã cải thiện query execution time của Q64 từ 383s xuống còn 81s. Với lợi ích lớn hơn khi sử dụng AWS Glue Data Catalog column statistics cho optimizer, bạn nên xem xét việc collecting stats cho data lake của mình bằng AWS Glue. Nếu workload của bạn là JOIN heavy workload, việc collecting stats sẽ mang lại cải thiện lớn hơn cho workload của bạn. Vui lòng tham khảo generating AWS Glue Data Catalog column statistics để biết hướng dẫn về cách collect statistics trong AWS Glue Data Catalog.</p><h2 id=tối-ưu-hóa-bằng-cách-viết-lại-truy-vấn>Tối ưu hóa bằng cách viết lại truy vấn</h2><p>Chúng tôi đã giới thiệu một new query rewrite rule kết hợp các scalar aggregates trên cùng một common expression nhưng sử dụng các predicates hơi khác nhau. Việc rewrite này đã dẫn đến performance improvements trên các TPC-DS queries Q09, Q28, và Q88. Hãy tập trung vào Q09 như một representative của các truy vấn này, được trình bày trong fragment dưới đây:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>CASE</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHEN</span> (<span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> store_sales
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> ss_quantity <span style=color:#66d9ef>BETWEEN</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>AND</span> <span style=color:#ae81ff>20</span>) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>48409437</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>THEN</span> (<span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>AVG</span>(ss_ext_discount_amt)
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> store_sales
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> ss_quantity <span style=color:#66d9ef>BETWEEN</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>AND</span> <span style=color:#ae81ff>20</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>ELSE</span> (<span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>AVG</span>(ss_net_profit)
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> store_sales
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> ss_quantity <span style=color:#66d9ef>BETWEEN</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>AND</span> <span style=color:#ae81ff>20</span>) <span style=color:#66d9ef>END</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>AS</span> bucket1,
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;&lt;</span><span style=color:#ae81ff>4</span> <span style=color:#66d9ef>more</span> variations <span style=color:#66d9ef>of</span> the <span style=color:#66d9ef>CASE</span> expression above<span style=color:#f92672>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> reason
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> r_reason_sk <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>Tổng cộng có 15 scans của fact table store_sales, mỗi scan trả về các aggregates khác nhau trên các subsets of data khác nhau. Query engine trước tiên thực hiện subquery removal và biến đổi các expressions khác nhau trong CASE statements thành các relational subtrees được kết nối thông qua cross products, sau đó chúng được fused thành một subquery duy nhất xử lý tất cả các scalar aggregates. Query plan kết quả cho Q09, được mô tả dưới đây bằng SQL để dễ hiểu, như sau:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> v1 <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>48409437</span> <span style=color:#66d9ef>THEN</span> t1 <span style=color:#66d9ef>ELSE</span> e1 <span style=color:#66d9ef>END</span>,
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#ae81ff>4</span> <span style=color:#66d9ef>more</span> variations<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> (<span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>COUNT</span>(<span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> b1 <span style=color:#66d9ef>THEN</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>END</span>) <span style=color:#66d9ef>AS</span> v1,
</span></span><span style=display:flex><span><span style=color:#66d9ef>AVG</span>(<span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> b1 <span style=color:#66d9ef>THEN</span> ss_ext_discount_amt <span style=color:#66d9ef>END</span>) <span style=color:#66d9ef>AS</span> t1,
</span></span><span style=display:flex><span><span style=color:#66d9ef>AVG</span>(<span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> b1 <span style=color:#66d9ef>THEN</span> ss_net_profit <span style=color:#66d9ef>END</span>) <span style=color:#66d9ef>AS</span> e1,
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#ae81ff>4</span> <span style=color:#66d9ef>more</span> variations<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> reason,
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span>,
</span></span><span style=display:flex><span>ss_quantity <span style=color:#66d9ef>BETWEEN</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>AND</span> <span style=color:#ae81ff>20</span> <span style=color:#66d9ef>AS</span> b1,
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#ae81ff>4</span> <span style=color:#66d9ef>more</span> variations<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> store_sales
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> ss_quantity <span style=color:#66d9ef>BETWEEN</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>AND</span> <span style=color:#ae81ff>20</span> <span style=color:#66d9ef>OR</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#ae81ff>4</span> <span style=color:#66d9ef>more</span> variations<span style=color:#f92672>&gt;</span>))
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> r_reason_sk <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>)
</span></span></code></pre></div><p>Nhìn chung, rewrite rule này mang lại cải thiện lớn nhất cả về latency (tăng tốc từ 3x đến 8x) và bytes read from Amazon S3 (giảm từ 6x đến 8x scanned bytes và, theo đó, giảm cost).</p><h2 id=bloom-filter-cho-các-cột-phân-vùng>Bloom filter cho các cột phân vùng</h2><p>Amazon Redshift đã sử dụng Bloom filters trên các data columns của external tables trong Amazon S3 để cho phép early and effective data filtering. Năm ngoái, chúng tôi đã mở rộng hỗ trợ này cho cả các partition columns.</p><p>Một Bloom filter là một probabilistic, memory-efficient data structure giúp accelerate join queries at scale bằng cách filter các rows không khớp với join relation, từ đó giảm đáng kể lượng dữ liệu được chuyển qua mạng. Amazon Redshift tự động xác định các queries phù hợp để sử dụng Bloom filters tại thời điểm query runtime.</p><p>Optimization này đã mang lại performance improvements cho các TPC-DS queries Q05, Q17, và Q54, với cải thiện lớn cả về latency (tăng từ 2x đến 3x) và bytes read from S3 (giảm từ 9x đến 15x scanned bytes và theo đó giảm cost).</p><p>Dưới đây là subquery của Q05 minh họa improvements với runtime filter.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span> s_store_id,
</span></span><span style=display:flex><span><span style=color:#66d9ef>sum</span>(sales_price) <span style=color:#66d9ef>as</span> sales,
</span></span><span style=display:flex><span><span style=color:#66d9ef>sum</span>(profit) <span style=color:#66d9ef>as</span> profit,
</span></span><span style=display:flex><span><span style=color:#66d9ef>sum</span>(return_amt) <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>returns</span>,
</span></span><span style=display:flex><span><span style=color:#66d9ef>sum</span>(net_loss) <span style=color:#66d9ef>as</span> profit_loss
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span>
</span></span><span style=display:flex><span>( <span style=color:#66d9ef>select</span>  ss_store_sk <span style=color:#66d9ef>as</span> store_sk,
</span></span><span style=display:flex><span>ss_sold_date_sk  <span style=color:#66d9ef>as</span> date_sk,
</span></span><span style=display:flex><span>ss_ext_sales_price <span style=color:#66d9ef>as</span> sales_price,
</span></span><span style=display:flex><span>ss_net_profit <span style=color:#66d9ef>as</span> profit,
</span></span><span style=display:flex><span><span style=color:#66d9ef>cast</span>(<span style=color:#ae81ff>0</span> <span style=color:#66d9ef>as</span> decimal(<span style=color:#ae81ff>7</span>,<span style=color:#ae81ff>2</span>)) <span style=color:#66d9ef>as</span> return_amt,
</span></span><span style=display:flex><span><span style=color:#66d9ef>cast</span>(<span style=color:#ae81ff>0</span> <span style=color:#66d9ef>as</span> decimal(<span style=color:#ae81ff>7</span>,<span style=color:#ae81ff>2</span>)) <span style=color:#66d9ef>as</span> net_loss
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> tpcds_3t_alls3_pp_ext.store_sales
</span></span><span style=display:flex><span><span style=color:#66d9ef>union</span> <span style=color:#66d9ef>all</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> sr_store_sk <span style=color:#66d9ef>as</span> store_sk,
</span></span><span style=display:flex><span>sr_returned_date_sk <span style=color:#66d9ef>as</span> date_sk,
</span></span><span style=display:flex><span><span style=color:#66d9ef>cast</span>(<span style=color:#ae81ff>0</span> <span style=color:#66d9ef>as</span> decimal(<span style=color:#ae81ff>7</span>,<span style=color:#ae81ff>2</span>)) <span style=color:#66d9ef>as</span> sales_price,
</span></span><span style=display:flex><span><span style=color:#66d9ef>cast</span>(<span style=color:#ae81ff>0</span> <span style=color:#66d9ef>as</span> decimal(<span style=color:#ae81ff>7</span>,<span style=color:#ae81ff>2</span>)) <span style=color:#66d9ef>as</span> profit,
</span></span><span style=display:flex><span>sr_return_amt <span style=color:#66d9ef>as</span> return_amt,
</span></span><span style=display:flex><span>sr_net_loss <span style=color:#66d9ef>as</span> net_loss
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> tpcds_3t_alls3_pp_ext.store_returns
</span></span><span style=display:flex><span>) salesreturnss,
</span></span><span style=display:flex><span>tpcds_3t_alls3_pp_ext.date_dim,
</span></span><span style=display:flex><span>tpcds_3t_alls3_pp_ext.store
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> date_sk <span style=color:#f92672>=</span> d_date_sk
</span></span><span style=display:flex><span><span style=color:#66d9ef>and</span> d_date <span style=color:#66d9ef>between</span> <span style=color:#66d9ef>cast</span>(<span style=color:#e6db74>&#39;1998-08-13&#39;</span> <span style=color:#66d9ef>as</span> date)
</span></span><span style=display:flex><span><span style=color:#66d9ef>and</span> (<span style=color:#66d9ef>cast</span>(<span style=color:#e6db74>&#39;1998-08-13&#39;</span> <span style=color:#66d9ef>as</span> date) <span style=color:#f92672>+</span>  <span style=color:#ae81ff>14</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>and</span> store_sk <span style=color:#f92672>=</span> s_store_sk
</span></span><span style=display:flex><span><span style=color:#66d9ef>group</span> <span style=color:#66d9ef>by</span> s_store_id
</span></span></code></pre></div><h3 id=without-bloom-filter-support-on-partition-columns>Without bloom filter support on partition columns</h3><p>Hình dưới đây là logical query plan cho sub-query của Q05. Query này appends hai large fact tables là store_sales (8B rows) và store_returns (863M rows), sau đó joins với các very selective dimension tables date_dim và tiếp theo với dimension table store. Bạn có thể quan sát rằng join với date_dim table đã reduce số lượng rows từ 9B xuống còn 93M rows.</p><p><img alt="Hình 7: Logical query plan cho sub-query của Q05 without bloom filter support on partition columns" src=../../../images/3-BlogsTranslated/3.2-Blog2/figure7-q05-without-bloom-filter.png></p><p><em>Hình 7: Logical query plan cho sub-query của Q05 without bloom filter support on partition columns</em></p><h3 id=with-bloom-filter-support-on-partition-columns>With bloom filter support on partition columns</h3><p>Với support of bloom filter trên các partition columns, chúng tôi hiện tạo bloom filter cho d_date_sk column của date_dim table và push down các bloom filters này xuống store_sales và store_returns table.</p><p>Các bloom filters này giúp filter out các partitions trong cả store_sales và store_returns table vì join diễn ra trên partition column (số lượng partitions processed giảm 10x).</p><p><img alt="Hình 8: Logical query plan cho sub-query của Q05 with bloom filter support on partition columns" src=../../../images/3-BlogsTranslated/3.2-Blog2/figure8-q05-with-bloom-filter.png></p><p><em>Hình 8: Logical query plan cho sub-query của Q05 with bloom filter support on partition columns</em></p><p>Nhìn chung, bloom filter trên partition column sẽ reduce the number of partitions processed, dẫn đến giảm các S3 listing calls và giảm số lượng data files cần đọc (reduction in scanned bytes). Bạn có thể thấy rằng chúng ta chỉ scan 89M rows từ store_sales và 4M rows từ store_returns nhờ bloom filter. Số lượng rows giảm này tại JOIN level đã giúp cải thiện overall query performance 2x và scanned bytes 9x.</p><h2 id=kết-luận>Kết luận</h2><p>Trong bài viết này, chúng tôi đã trình bày các performance optimizations mới trong Amazon Redshift data lake query processing và cách AWS Glue Data Catalog statistics giúp enhance quality of query plans cho các data lake queries trong Amazon Redshift. Các optimizations này đã cải thiện đáng kể query performance, với TPC-DS 3TB benchmark cho thấy cải thiện 3x về tổng thời gian thực thi. Một số truy vấn riêng lẻ đạt tốc độ nhanh hơn lên đến 12x. Chúng tôi khuyến nghị sử dụng AWS Glue Data Catalog column statistics, đặc biệt cho các JOIN-heavy workloads, để đạt được query performance tối ưu cho các truy vấn data lake của bạn.</p><p>Tóm lại, Amazon Redshift hiện cung cấp enhanced query performance với các optimizations như: AWS Glue Data Catalog column statistics, bloom filters trên partition columns, new query rewrite rules, và faster retrieval of metadata. Các optimizations này được enabled by default, và người dùng Amazon Redshift sẽ được hưởng lợi với better query response times cho workloads của mình.</p><p>Để biết thêm thông tin, vui lòng liên hệ với AWS technical account manager hoặc AWS account solutions architect của bạn. Họ sẽ sẵn sàng cung cấp additional guidance and support.</p><hr><h2 id=về-các-tác-giả>Về các Tác giả</h2><p><img alt="Kalaiselvi Kamaraj" src=../../../images/3-BlogsTranslated/3.2-Blog2/Kalaiselvi-Kamaraj.png></p><h3 id=kalaiselvi-kamaraj>Kalaiselvi Kamaraj</h3><p>Kalaiselvi Kamaraj là Sr. Software Development Engineer tại Amazon. Cô đã tham gia nhiều dự án trong đội ngũ Redshift Query Processing và hiện đang tập trung vào các dự án liên quan đến performance cho Redshift Data Lake.</p><p><img alt="Mark Lyons" src=../../../images/3-BlogsTranslated/3.2-Blog2/Mark-Lyons.png></p><h3 id=mark-lyons>Mark Lyons</h3><p>Mark Lyons là Principal Product Manager trong đội ngũ Amazon Redshift. Anh làm việc tại giao điểm giữa data lakes và data warehouses. Trước khi gia nhập AWS, Mark đảm nhiệm các vị trí product leadership tại Dremio và Vertica. Anh đam mê data analytics và mong muốn empowering customers để họ có thể change the world with their data.</p><p><img alt="Asser Moustafa" src=../../../images/3-BlogsTranslated/3.2-Blog2/Asser-Moustafa.png></p><h3 id=asser-moustafa>Asser Moustafa</h3><p>Asser Moustafa là Principal Worldwide Specialist Solutions Architect tại AWS, có trụ sở tại Dallas, Texas, USA. Ông hợp tác với khách hàng trên toàn cầu, tư vấn về tất cả các khía cạnh của data architectures, migrations, và strategic data visions nhằm giúp các tổ chức adopt cloud-based solutions, maximize the value of their data assets, modernize legacy infrastructures, và triển khai các cutting-edge capabilities như machine learning và advanced analytics. Trước khi gia nhập AWS, Asser đảm nhiệm nhiều vị trí lãnh đạo về data và analytics, đồng thời hoàn thành MBA tại New York University và MS in Computer Science tại Columbia University, New York. Ông đam mê việc giúp các tổ chức trở nên truly data-driven và khai thác transformative potential từ dữ liệu của họ.</p><p><strong>TAGS:</strong> Amazon Redshift Spectrum, Analytics, Data Lake, optimization, Performance</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=../../../vi/3-blogstranslated/3.1-blog1/ title="Blog 1"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=../../../vi/3-blogstranslated/3.3-blog3/ title="Blog 3" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=../../../js/clipboard.min.js?1765261581></script><script src=../../../js/perfect-scrollbar.min.js?1765261581></script><script src=../../../js/perfect-scrollbar.jquery.min.js?1765261581></script><script src=../../../js/jquery.sticky.js?1765261581></script><script src=../../../js/featherlight.min.js?1765261581></script><script src=../../../js/highlight.pack.js?1765261581></script><script>hljs.initHighlightingOnLoad()</script><script src=../../../js/modernizr.custom-3.6.0.js?1765261581></script><script src=../../../js/learn.js?1765261581></script><script src=../../../js/hugo-learn.js?1765261581></script><link href=../../../mermaid/mermaid.css?1765261581 rel=stylesheet><script src=../../../mermaid/mermaid.js?1765261581></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date),(i=t.createElement(n),a=t.getElementsByTagName(n)[0]),i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>