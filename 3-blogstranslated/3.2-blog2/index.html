<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=description content><meta name=author content="thienlh@thienlu.com"><link rel=icon href=../../images/favicon.png type=image/png><title>Blog 2 :: Internship Report</title>
<link href=../../css/nucleus.css?1765261581 rel=stylesheet><link href=../../css/fontawesome-all.min.css?1765261581 rel=stylesheet><link href=../../css/hybrid.css?1765261581 rel=stylesheet><link href=../../css/featherlight.min.css?1765261581 rel=stylesheet><link href=../../css/perfect-scrollbar.min.css?1765261581 rel=stylesheet><link href=../../css/auto-complete.css?1765261581 rel=stylesheet><link href=../../css/atom-one-dark-reasonable.css?1765261581 rel=stylesheet><link href=../../css/theme.css?1765261581 rel=stylesheet><link href=../../css/hugo-theme.css?1765261581 rel=stylesheet><link href=../../css/theme-workshop.css?1765261581 rel=stylesheet><script src=../../js/jquery-3.3.1.min.js?1765261581></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=../../3-blogstranslated/3.2-blog2/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=../../><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=../../js/lunr.min.js?1765261581></script><script type=text/javascript src=../../js/auto-complete.js?1765261581></script><script type=text/javascript>var baseurl="https://thienluhoan.github.io/workshop-template/"</script><script type=text/javascript src=../../js/search.js?1765261581></script></div><div class=highlightable><ul class=topics><li data-nav-id=/1-worklog/ title=Worklog class=dd-item><a href=../../1-worklog/><b>1. </b>Worklog
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/1-worklog/1.1-week1/ title="Week 1 Worklog" class=dd-item><a href=../../1-worklog/1.1-week1/><b>1.1. </b>Week 1 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.2-week2/ title="Week 2 Worklog" class=dd-item><a href=../../1-worklog/1.2-week2/><b>1.2. </b>Week 2 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.3-week3/ title="Week 3 Worklog" class=dd-item><a href=../../1-worklog/1.3-week3/><b>1.3. </b>Week 3 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.4-week4/ title="Week 4 Worklog" class=dd-item><a href=../../1-worklog/1.4-week4/><b>1.4. </b>Week 4 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.5-week5/ title="Week 5 Worklog" class=dd-item><a href=../../1-worklog/1.5-week5/><b>1.5. </b>Week 5 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.6-week6/ title="Week 6 Worklog" class=dd-item><a href=../../1-worklog/1.6-week6/><b>1.6. </b>Week 6 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.7-week7/ title="Week 7 Worklog" class=dd-item><a href=../../1-worklog/1.7-week7/><b>1.7. </b>Week 7 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.8-week8/ title="Week 8 Worklog" class=dd-item><a href=../../1-worklog/1.8-week8/><b>1.8. </b>Week 8 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.9-week9/ title="Week 9 Worklog" class=dd-item><a href=../../1-worklog/1.9-week9/><b>1.9. </b>Week 9 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.10-week10/ title="Week 10 Worklog" class=dd-item><a href=../../1-worklog/1.10-week10/><b>1.10. </b>Week 10 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.11-week11/ title="Week 11 Worklog" class=dd-item><a href=../../1-worklog/1.11-week11/><b>1.11. </b>Week 11 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.12-week12/ title="Week 12 Worklog" class=dd-item><a href=../../1-worklog/1.12-week12/><b>1.12 </b>Week 12 Worklog
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/2-proposal/ title=Proposal class=dd-item><a href=../../2-proposal/><b>2. </b>Proposal
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/ title="Translated Blogs" class="dd-item
parent"><a href=../../3-blogstranslated/><b>3. </b>Translated Blogs
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/3-blogstranslated/3.1-blog1/ title="Blog 1" class=dd-item><a href=../../3-blogstranslated/3.1-blog1/><b>3.1. </b>Blog 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.2-blog2/ title="Blog 2" class="dd-item
active"><a href=../../3-blogstranslated/3.2-blog2/><b>3.2. </b>Blog 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.3-blog3/ title="Blog 3" class=dd-item><a href=../../3-blogstranslated/3.3-blog3/><b>3.3. </b>Blog 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.4-blog4/ title="Blog 4" class=dd-item><a href=../../3-blogstranslated/3.4-blog4/><b>3.4. </b>Blog 4
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.5-blog5/ title="Blog 5" class=dd-item><a href=../../3-blogstranslated/3.5-blog5/><b>3.5. </b>Blog 5
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.6-blog6/ title="Blog 6" class=dd-item><a href=../../3-blogstranslated/3.6-blog6/><b>3.6. </b>Blog 6
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/4-eventparticipated/ title="Events Participated" class=dd-item><a href=../../4-eventparticipated/><b>4. </b>Events Participated
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/4-eventparticipated/4.1-event1/ title="Event 1" class=dd-item><a href=../../4-eventparticipated/4.1-event1/><b>4.1. </b>Event 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.2-event2/ title="Event 2" class=dd-item><a href=../../4-eventparticipated/4.2-event2/><b>4.2. </b>Event 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.3-event3/ title="Event 3" class=dd-item><a href=../../4-eventparticipated/4.3-event3/><b>4.3. </b>Event 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.4-event4/ title="Event 4" class=dd-item><a href=../../4-eventparticipated/4.4-event4/><b>4.4. </b>Event 4
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.5-event5/ title="Event 5" class=dd-item><a href=../../4-eventparticipated/4.5-event5/><b>4.5. </b>Event 5
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-workshop/ title=Workshop class=dd-item><a href=../../5-workshop/><b>5. </b>Workshop
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.1-workshop-overview/ title=Introduction class=dd-item><a href=../../5-workshop/5.1-workshop-overview/><b>5.1. </b>Introduction
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.2-prerequiste/ title=Prerequiste class=dd-item><a href=../../5-workshop/5.2-prerequiste/><b>5.2. </b>Prerequiste
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.3-s3-vpc/ title="Network Infrastructure Setup" class=dd-item><a href=../../5-workshop/5.3-s3-vpc/><b>5.3. </b>Network Infrastructure Setup
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.3-s3-vpc/5.3.1-create-gwe/ title="Create VPC & Subnets" class=dd-item><a href=../../5-workshop/5.3-s3-vpc/5.3.1-create-gwe/><b>5.3.1 </b>Create VPC & Subnets
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.3-s3-vpc/5.3.2-test-gwe/ title="Configure Internet & NAT Gateway" class=dd-item><a href=../../5-workshop/5.3-s3-vpc/5.3.2-test-gwe/><b>5.3.2 </b>Configure Internet & NAT Gateway
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-workshop/5.4-s3-onprem/ title="Data Layer Deployment" class=dd-item><a href=../../5-workshop/5.4-s3-onprem/><b>5.4. </b>Data Layer Deployment
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.4-s3-onprem/5.4.1-prepare/ title="Set up Security Groups" class=dd-item><a href=../../5-workshop/5.4-s3-onprem/5.4.1-prepare/><b>5.4.1 </b>Set up Security Groups
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.4-s3-onprem/5.4.2-create-interface-enpoint/ title="Initialize Amazon RDS" class=dd-item><a href=../../5-workshop/5.4-s3-onprem/5.4.2-create-interface-enpoint/><b>5.4.2 </b>Initialize Amazon RDS
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.4-s3-onprem/5.4.3-test-endpoint/ title="Initialize ElastiCache Redis" class=dd-item><a href=../../5-workshop/5.4-s3-onprem/5.4.3-test-endpoint/><b>5.4.3 </b>Initialize ElastiCache Redis
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-workshop/5.5-policy/ title="Application Deployment" class=dd-item><a href=../../5-workshop/5.5-policy/><b>5.5. </b>Application Deployment
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.5-policy/5.5.2-initialize-elastic-beanstalk/ title="Initialize Elastic Beanstalk" class=dd-item><a href=../../5-workshop/5.5-policy/5.5.2-initialize-elastic-beanstalk/><b>5.5.2 </b>Initialize Elastic Beanstalk
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.5-policy/5.5.1-package-with-docker/ title="Package with Docker" class=dd-item><a href=../../5-workshop/5.5-policy/5.5.1-package-with-docker/><b>5.5.1 </b>Package with Docker
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-workshop/5.6-monitoringoperations/ title="Monitoring & Operations" class=dd-item><a href=../../5-workshop/5.6-monitoringoperations/><b>5.6. </b>Monitoring & Operations
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.7-clean-up/ title="Clean Up" class=dd-item><a href=../../5-workshop/5.7-clean-up/><b>5.7. </b>Clean Up
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/6-self-evaluation/ title=Self-Assessment class=dd-item><a href=../../6-self-evaluation/><b>6. </b>Self-Assessment
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/7-feedback/ title="Sharing and Feedback" class=dd-item><a href=../../7-feedback/><b>7. </b>Sharing and Feedback
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://thienluhoan.github.io/workshop-template/3-blogstranslated/3.2-blog2/ selected>English</option><option id=vi value=https://thienluhoan.github.io/workshop-template/vi/3-blogstranslated/3.2-blog2/>Tiếng Việt</option></select><svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><span id=lastUpdated style=color:orange></span>
</i><script>const today=new Date,formattedDate=today.toLocaleDateString("en-GB");document.getElementById("lastUpdated").textContent=formattedDate</script></left><left><br><br><b>Team</b><br><i><a href=https://www.facebook.com/groups/660548818043427 style=color:orange>First Cloud Journey</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=../../>Internship Report</a> > <a href=../../3-blogstranslated/>Translated Blogs</a> > Blog 2</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#performance-improvements>Performance improvements</a></li><li><a href=#optimization-with-table-level-statistics>Optimization with table-level statistics</a></li><li><a href=#performance-improvements-with-aws-glue-data-catalog-column-statistics>Performance improvements with AWS Glue Data Catalog column statistics</a><ul><li><a href=#without-using-statistics>Without using Statistics</a></li><li><a href=#using-statistics>Using Statistics</a></li></ul></li><li><a href=#optimization-by-query-rewriting>Optimization by query rewriting</a></li><li><a href=#bloom-filter-for-partition-columns>Bloom filter for partition columns</a><ul><li><a href=#without-bloom-filter-support-on-partition-columns>Without bloom filter support on partition columns</a></li><li><a href=#with-bloom-filter-support-on-partition-columns>With bloom filter support on partition columns</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#about-the-authors>About the Authors</a><ul><li><a href=#kalaiselvi-kamaraj>Kalaiselvi Kamaraj</a></li><li><a href=#mark-lyons>Mark Lyons</a></li><li><a href=#asser-moustafa>Asser Moustafa</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Blog 2</h1><h1 id=accelerate-amazon-redshift-data-lake-queries-with-aws-glue-data-catalog-column-statistics>Accelerate Amazon Redshift Data Lake queries with AWS Glue Data Catalog Column Statistics</h1><p>by Kalaiselvi Kamaraj, Asser Moustafa, and Mark Lyons | on 01 OCT 2024 in | Amazon Redshift | Amazon Simple Storage Service (S3) | Analytics, Announcements | AWS Big Data | AWS Glue | Best Practices Permalink</p><p>Amazon Redshift allows you to query and retrieve structured and semi-structured data from open format files in Amazon S3 data lakes without needing to load data into Amazon Redshift tables. Amazon Redshift extends SQL capabilities to the data lake, enabling you to run analytical queries. Redshift supports many different table data formats such as CSV, JSON, Parquet, ORC, and open table formats like Apache Hudi, Linux Foundation Delta Lake, and Apache Iceberg.</p><p>You create Redshift external tables by defining the structure for files, the S3 location of files, and registering them as tables in an external data catalog. The external data catalog can be AWS Glue Data Catalog, the data catalog that comes with Amazon Athena, or your Apache Hive metastore.</p><p>Over the past year, Amazon Redshift has added several performance optimizations for data lake queries across many aspects of the query engine such as rewrite, planning, scan execution, and using AWS Glue Data Catalog column statistics. To achieve the best performance for data lake queries with Redshift, you can use AWS Glue Data Catalog column statistics to collect statistics on Data Lake tables. For Amazon Redshift Serverless instances, you&rsquo;ll see scan performance improvements due to increased parallel processing of S3 files, and this happens automatically based on RPUs used.</p><p>In this post, we highlight the performance improvements observed using industry-standard TPC-DS benchmarks. The total execution time of the TPC-DS 3 TB benchmark improved by 3x. Some queries in the benchmark achieved speeds up to 12x faster.</p><h2 id=performance-improvements>Performance improvements</h2><p>Over the past year, there have been many performance optimizations made to improve the performance of data lake queries, including:</p><ul><li>Using AWS Glue Data Catalog column statistics and tuning the Redshift optimizer to improve query plan quality.</li><li>Using bloom filters for partition columns.</li><li>Improving scan efficiency for Amazon Redshift Serverless instances through increased parallel processing of files.</li><li>Applying novel query rewrite rules to merge similar scans.</li><li>Faster metadata retrieval from AWS Glue Data Catalog.</li></ul><p>To understand the performance gains, we tested performance using the industry-standard TPC-DS benchmark with 3 TB datasets and queries, representing different customer use cases. Performance was tested on a Redshift serverless data warehouse with 128 RPU. In the test, the dataset was stored on Amazon S3 in Parquet format, and AWS Glue Data Catalog was used to manage external databases and tables. Fact tables were partitioned by date column, with each table containing approximately 2,000 partitions. All tables had the row count table property, numRows, set according to spectrum query performance guidelines.</p><p>We performed a baseline run on last year&rsquo;s Redshift patch version (patch 172). Then, we ran all TPC-DS queries on the latest patch version (patch 180), including all performance optimizations added over the past year. Next, we used AWS Glue Data Catalog column statistics to compute statistics for all tables and measured the performance improvement when column statistics are available.</p><p>Analysis showed that the TPC-DS 3TB Parquet benchmark achieved significant performance gains thanks to these optimizations. Specifically, partitioned Parquet with the latest optimizations achieved 2x faster runtime compared to the previous implementation. Enabling AWS Glue Data Catalog column statistics further improved performance by 3x compared to last year. The graph below illustrates runtime improvements for the entire benchmark (all TPC-DS queries) over the past year, including the additional boost from using AWS Glue Data Catalog column statistics.</p><p><img alt="Figure 1: Total execution time improvements for TPC-DS 3T workload" src=../../images/3-BlogsTranslated/3.2-Blog2/figure1-total-runtime-improvements.png></p><p><em>Figure 1: Total execution time improvements for TPC-DS 3T workload</em></p><p>The graph below presents the top queries from the TPC-DS benchmark with the largest performance improvements over the past year, with and without AWS Glue Data Catalog column statistics. You can see that performance improves significantly when statistics are available on AWS Glue Data Catalog (for details on how to collect statistics for Data Lake tables, please refer to optimizing query performance using AWS Glue Data Catalog column statistics). Specifically, multi-join queries will benefit most from AWS Glue Data Catalog column statistics, because the optimizer uses statistics to choose the appropriate join order and distribution strategy.</p><p><img alt="Figure 2: Speed-up in TPC-DS queries" src=../../images/3-BlogsTranslated/3.2-Blog2/figure2-speedup-queries.png></p><p><em>Figure 2: Speed-up in TPC-DS queries</em></p><p>Let&rsquo;s discuss some optimizations that have contributed to improved query performance.</p><h2 id=optimization-with-table-level-statistics>Optimization with table-level statistics</h2><p>Amazon Redshift is designed to handle large-scale data challenges with superior speed and cost-efficiency. The massively parallel processing (MPP) query engine, AI-powered query optimizer, auto-scaling capabilities, and other advanced features help Redshift excel at searching, aggregating, and transforming petabytes of data.</p><p>However, even the most powerful systems can experience performance degradation if they encounter anti-patterns such as extremely inaccurate table statistics, for example, row count metadata.</p><p>Without this critical metadata, Redshift&rsquo;s query optimizer can be limited in the number of possible optimizations, especially those related to data distribution during query execution. This can significantly impact overall query performance.</p><p>To illustrate, consider a simple query involving an inner join between a large table with billions of rows and a small table with only a few hundred thousand rows.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span> small_table.sellerid, <span style=color:#66d9ef>sum</span>(large_table.qtysold)
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> large_table, small_table
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> large_table.salesid <span style=color:#f92672>=</span> small_table.listid
</span></span><span style=display:flex><span> <span style=color:#66d9ef>and</span> small_table.listtime <span style=color:#f92672>&gt;</span> <span style=color:#e6db74>&#39;2023-12-01&#39;</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>and</span> large_table.saletime <span style=color:#f92672>&gt;</span> <span style=color:#e6db74>&#39;2023-12-01&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>group</span> <span style=color:#66d9ef>by</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>If executed as-is, with the large table on the right-hand side of the join, the query will lead to sub-optimal performance. This is because the large table will need to be distributed (broadcast) to all Redshift compute nodes to perform the inner join with the small table, as illustrated in the diagram below.</p><p><img alt="Figure 3: Inaccurate table statistics lead to limited optimizations and large amounts of data being broadcast between compute nodes for a simple inner join" src=../../images/3-BlogsTranslated/3.2-Blog2/figure3-inaccurate-statistics.png></p><p><em>Figure 3: Inaccurate table statistics lead to limited optimizations and large amounts of data being broadcast between compute nodes for a simple inner join</em></p><p>Now, consider a scenario where table statistics, such as row count, are accurate. This allows the Amazon Redshift query optimizer to make more informed decisions, such as determining the optimal join order. In this case, the optimizer will immediately rewrite the query so the large table is on the left-hand side of the inner join, making the small table the one broadcast to Redshift compute nodes, as illustrated in the diagram below.</p><p><img alt="Figure 4: Accurate table statistics lead to a high degree of optimizations and very little data being broadcast between compute nodes for a simple inner join" src=../../images/3-BlogsTranslated/3.2-Blog2/figure4-accurate-statistics.png></p><p><em>Figure 4: Accurate table statistics lead to a high degree of optimizations and very little data being broadcast between compute nodes for a simple inner join</em></p><p>Fortunately, Amazon Redshift automatically maintains accurate table statistics for local tables by running ANALYZE in the background. However, for external tables (data lake tables), using AWS Glue Data Catalog column statistics is recommended when working with Amazon Redshift, as we will discuss in the next section. For more general information about optimizing queries in Amazon Redshift, please refer to the documentation on factors affecting query performance, data redistribution, and Amazon Redshift best practices for designing queries.</p><h2 id=performance-improvements-with-aws-glue-data-catalog-column-statistics>Performance improvements with AWS Glue Data Catalog column statistics</h2><p>AWS Glue Data Catalog has a feature to compute column-level statistics for Amazon S3-backed external tables. AWS Glue Data Catalog can compute column-level statistics such as NDV, Number of Nulls, Min/Max, and Avg. column width for columns without requiring additional data pipelines.</p><p>Amazon Redshift&rsquo;s cost-based optimizer uses these statistics to generate better quality query plans. In addition to using statistics, we also made improvements in cardinality estimations and cost tuning to obtain high-quality query plans, thereby improving query performance.</p><p>With the TPC-DS 3TB dataset, total query execution time improved by 40% when using AWS Glue Data Catalog column statistics. Some individual TPC-DS queries improved up to 5x in execution time. Some queries with significant impact on execution time include Q85, Q64, Q75, Q78, Q94, Q16, Q04, Q24, and Q11.</p><p>We&rsquo;ll go through an example where the cost-based optimizer generates a better query plan thanks to statistics and how it improves execution time.</p><p>Consider the simpler version of TPC-DS Q64 below to illustrate query plan differences when statistics are available.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span> i_product_name product_name
</span></span><span style=display:flex><span>,i_item_sk item_sk
</span></span><span style=display:flex><span>,ad1.ca_street_number b_street_number
</span></span><span style=display:flex><span>,ad1.ca_street_name b_street_name
</span></span><span style=display:flex><span>,ad1.ca_city b_city
</span></span><span style=display:flex><span>,ad1.ca_zip b_zip
</span></span><span style=display:flex><span>,d1.d_year <span style=color:#66d9ef>as</span> syear
</span></span><span style=display:flex><span>,<span style=color:#66d9ef>count</span>(<span style=color:#f92672>*</span>) cnt
</span></span><span style=display:flex><span>,<span style=color:#66d9ef>sum</span>(ss_wholesale_cost) s1
</span></span><span style=display:flex><span>,<span style=color:#66d9ef>sum</span>(ss_list_price) s2
</span></span><span style=display:flex><span>,<span style=color:#66d9ef>sum</span>(ss_coupon_amt) s3
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span>   tpcds_3t_alls3_pp_ext.store_sales
</span></span><span style=display:flex><span>,tpcds_3t_alls3_pp_ext.store_returns
</span></span><span style=display:flex><span>,tpcds_3t_alls3_pp_ext.date_dim d1
</span></span><span style=display:flex><span>,tpcds_3t_alls3_pp_ext.customer
</span></span><span style=display:flex><span>,tpcds_3t_alls3_pp_ext.customer_address ad1
</span></span><span style=display:flex><span>,tpcds_3t_alls3_pp_ext.item
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span>
</span></span><span style=display:flex><span>ss_sold_date_sk <span style=color:#f92672>=</span> d1.d_date_sk <span style=color:#66d9ef>AND</span>
</span></span><span style=display:flex><span>ss_customer_sk <span style=color:#f92672>=</span> c_customer_sk <span style=color:#66d9ef>AND</span>
</span></span><span style=display:flex><span>ss_addr_sk <span style=color:#f92672>=</span> ad1.ca_address_sk <span style=color:#66d9ef>and</span>
</span></span><span style=display:flex><span>ss_item_sk <span style=color:#f92672>=</span> i_item_sk <span style=color:#66d9ef>and</span>
</span></span><span style=display:flex><span>ss_item_sk <span style=color:#f92672>=</span> sr_item_sk <span style=color:#66d9ef>and</span>
</span></span><span style=display:flex><span>ss_ticket_number <span style=color:#f92672>=</span> sr_ticket_number <span style=color:#66d9ef>and</span>
</span></span><span style=display:flex><span>i_color <span style=color:#66d9ef>in</span> (<span style=color:#e6db74>&#39;firebrick&#39;</span>,<span style=color:#e6db74>&#39;papaya&#39;</span>,<span style=color:#e6db74>&#39;orange&#39;</span>,<span style=color:#e6db74>&#39;cream&#39;</span>,<span style=color:#e6db74>&#39;turquoise&#39;</span>,<span style=color:#e6db74>&#39;deep&#39;</span>) <span style=color:#66d9ef>and</span>
</span></span><span style=display:flex><span>i_current_price <span style=color:#66d9ef>between</span> <span style=color:#ae81ff>42</span> <span style=color:#66d9ef>and</span> <span style=color:#ae81ff>42</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>10</span> <span style=color:#66d9ef>and</span>
</span></span><span style=display:flex><span>i_current_price <span style=color:#66d9ef>between</span> <span style=color:#ae81ff>42</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>and</span> <span style=color:#ae81ff>42</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>15</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>group</span> <span style=color:#66d9ef>by</span> i_product_name
</span></span><span style=display:flex><span>,i_item_sk
</span></span><span style=display:flex><span>,ad1.ca_street_number
</span></span><span style=display:flex><span>,ad1.ca_street_name
</span></span><span style=display:flex><span>,ad1.ca_city
</span></span><span style=display:flex><span>,ad1.ca_zip
</span></span><span style=display:flex><span>,d1.d_year
</span></span></code></pre></div><h3 id=without-using-statistics>Without using Statistics</h3><p>The figure below shows the logical query plan of Q64. You can notice that the cardinality estimation of the joins is inaccurate. With inaccurate cardinalities, the optimizer will generate a sub-optimal query plan, leading to higher execution time.</p><p><img alt="Figure 5: Logical query plan of Q64 when not using statistics" src=../../images/3-BlogsTranslated/3.2-Blog2/figure5-q64-without-statistics.png></p><p><em>Figure 5: Logical query plan of Q64 when not using statistics</em></p><h3 id=using-statistics>Using Statistics</h3><p>The figure below shows the logical query plan after using AWS Glue Data Catalog column statistics. Based on the highlighted changes, you can see that the cardinality estimations of JOINs have improved significantly, helping the optimizer choose a better join order and join strategy (broadcast DS_BCAST_INNER vs. distribute DS_DIST_BOTH). The swapping of customer_address and customer tables from inner to outer table and changing join strategies to distribute has a large impact because this reduces data movement between nodes and avoids spilling from hash tables.</p><p><img alt="Figure 6: Logical query plan of Q64 after consuming AWS Glue Data Catalog column statistics" src=../../images/3-BlogsTranslated/3.2-Blog2/figure6-q64-with-statistics.png></p><p><em>Figure 6: Logical query plan of Q64 after consuming AWS Glue Data Catalog column statistics</em></p><p>This change in query plan improved Q64&rsquo;s query execution time from 383s to 81s. With the greater benefits of using AWS Glue Data Catalog column statistics for the optimizer, you should consider collecting stats for your data lake using AWS Glue. If your workload is a JOIN-heavy workload, collecting stats will bring greater improvements to your workload. Please refer to generating AWS Glue Data Catalog column statistics for guidance on how to collect statistics in AWS Glue Data Catalog.</p><h2 id=optimization-by-query-rewriting>Optimization by query rewriting</h2><p>We introduced a new query rewrite rule that combines scalar aggregates on the same common expression but using slightly different predicates. This rewrite has led to performance improvements on TPC-DS queries Q09, Q28, and Q88. Let&rsquo;s focus on Q09 as a representative of these queries, presented in the fragment below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>CASE</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHEN</span> (<span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> store_sales
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> ss_quantity <span style=color:#66d9ef>BETWEEN</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>AND</span> <span style=color:#ae81ff>20</span>) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>48409437</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>THEN</span> (<span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>AVG</span>(ss_ext_discount_amt)
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> store_sales
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> ss_quantity <span style=color:#66d9ef>BETWEEN</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>AND</span> <span style=color:#ae81ff>20</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>ELSE</span> (<span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>AVG</span>(ss_net_profit)
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> store_sales
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> ss_quantity <span style=color:#66d9ef>BETWEEN</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>AND</span> <span style=color:#ae81ff>20</span>) <span style=color:#66d9ef>END</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>AS</span> bucket1,
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;&lt;</span><span style=color:#ae81ff>4</span> <span style=color:#66d9ef>more</span> variations <span style=color:#66d9ef>of</span> the <span style=color:#66d9ef>CASE</span> expression above<span style=color:#f92672>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> reason
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> r_reason_sk <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>There are a total of 15 scans of the fact table store_sales, each scan returning different aggregates on different subsets of data. The query engine first performs subquery removal and transforms the different expressions in CASE statements into relational subtrees connected through cross products, then they are fused into a single subquery handling all scalar aggregates. The resulting query plan for Q09, described below in SQL for easier understanding, is as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> v1 <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>48409437</span> <span style=color:#66d9ef>THEN</span> t1 <span style=color:#66d9ef>ELSE</span> e1 <span style=color:#66d9ef>END</span>,
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#ae81ff>4</span> <span style=color:#66d9ef>more</span> variations<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> (<span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>COUNT</span>(<span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> b1 <span style=color:#66d9ef>THEN</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>END</span>) <span style=color:#66d9ef>AS</span> v1,
</span></span><span style=display:flex><span><span style=color:#66d9ef>AVG</span>(<span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> b1 <span style=color:#66d9ef>THEN</span> ss_ext_discount_amt <span style=color:#66d9ef>END</span>) <span style=color:#66d9ef>AS</span> t1,
</span></span><span style=display:flex><span><span style=color:#66d9ef>AVG</span>(<span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> b1 <span style=color:#66d9ef>THEN</span> ss_net_profit <span style=color:#66d9ef>END</span>) <span style=color:#66d9ef>AS</span> e1,
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#ae81ff>4</span> <span style=color:#66d9ef>more</span> variations<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> reason,
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span>,
</span></span><span style=display:flex><span>ss_quantity <span style=color:#66d9ef>BETWEEN</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>AND</span> <span style=color:#ae81ff>20</span> <span style=color:#66d9ef>AS</span> b1,
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#ae81ff>4</span> <span style=color:#66d9ef>more</span> variations<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> store_sales
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> ss_quantity <span style=color:#66d9ef>BETWEEN</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>AND</span> <span style=color:#ae81ff>20</span> <span style=color:#66d9ef>OR</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#ae81ff>4</span> <span style=color:#66d9ef>more</span> variations<span style=color:#f92672>&gt;</span>))
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> r_reason_sk <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>)
</span></span></code></pre></div><p>Overall, this rewrite rule brings the greatest improvements both in latency (3x to 8x speedup) and bytes read from Amazon S3 (6x to 8x reduction in scanned bytes and, accordingly, cost reduction).</p><h2 id=bloom-filter-for-partition-columns>Bloom filter for partition columns</h2><p>Amazon Redshift has been using Bloom filters on data columns of external tables in Amazon S3 to enable early and effective data filtering. Last year, we extended this support to partition columns as well.</p><p>A Bloom filter is a probabilistic, memory-efficient data structure that helps accelerate join queries at scale by filtering rows that don&rsquo;t match the join relation, thereby significantly reducing the amount of data transferred over the network. Amazon Redshift automatically identifies suitable queries to use Bloom filters at query runtime.</p><p>This optimization has brought performance improvements to TPC-DS queries Q05, Q17, and Q54, with large improvements both in latency (2x to 3x speedup) and bytes read from S3 (9x to 15x reduction in scanned bytes and accordingly cost reduction).</p><p>Below is a subquery of Q05 illustrating improvements with runtime filter.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span> s_store_id,
</span></span><span style=display:flex><span><span style=color:#66d9ef>sum</span>(sales_price) <span style=color:#66d9ef>as</span> sales,
</span></span><span style=display:flex><span><span style=color:#66d9ef>sum</span>(profit) <span style=color:#66d9ef>as</span> profit,
</span></span><span style=display:flex><span><span style=color:#66d9ef>sum</span>(return_amt) <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>returns</span>,
</span></span><span style=display:flex><span><span style=color:#66d9ef>sum</span>(net_loss) <span style=color:#66d9ef>as</span> profit_loss
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span>
</span></span><span style=display:flex><span>( <span style=color:#66d9ef>select</span>  ss_store_sk <span style=color:#66d9ef>as</span> store_sk,
</span></span><span style=display:flex><span>ss_sold_date_sk  <span style=color:#66d9ef>as</span> date_sk,
</span></span><span style=display:flex><span>ss_ext_sales_price <span style=color:#66d9ef>as</span> sales_price,
</span></span><span style=display:flex><span>ss_net_profit <span style=color:#66d9ef>as</span> profit,
</span></span><span style=display:flex><span><span style=color:#66d9ef>cast</span>(<span style=color:#ae81ff>0</span> <span style=color:#66d9ef>as</span> decimal(<span style=color:#ae81ff>7</span>,<span style=color:#ae81ff>2</span>)) <span style=color:#66d9ef>as</span> return_amt,
</span></span><span style=display:flex><span><span style=color:#66d9ef>cast</span>(<span style=color:#ae81ff>0</span> <span style=color:#66d9ef>as</span> decimal(<span style=color:#ae81ff>7</span>,<span style=color:#ae81ff>2</span>)) <span style=color:#66d9ef>as</span> net_loss
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> tpcds_3t_alls3_pp_ext.store_sales
</span></span><span style=display:flex><span><span style=color:#66d9ef>union</span> <span style=color:#66d9ef>all</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> sr_store_sk <span style=color:#66d9ef>as</span> store_sk,
</span></span><span style=display:flex><span>sr_returned_date_sk <span style=color:#66d9ef>as</span> date_sk,
</span></span><span style=display:flex><span><span style=color:#66d9ef>cast</span>(<span style=color:#ae81ff>0</span> <span style=color:#66d9ef>as</span> decimal(<span style=color:#ae81ff>7</span>,<span style=color:#ae81ff>2</span>)) <span style=color:#66d9ef>as</span> sales_price,
</span></span><span style=display:flex><span><span style=color:#66d9ef>cast</span>(<span style=color:#ae81ff>0</span> <span style=color:#66d9ef>as</span> decimal(<span style=color:#ae81ff>7</span>,<span style=color:#ae81ff>2</span>)) <span style=color:#66d9ef>as</span> profit,
</span></span><span style=display:flex><span>sr_return_amt <span style=color:#66d9ef>as</span> return_amt,
</span></span><span style=display:flex><span>sr_net_loss <span style=color:#66d9ef>as</span> net_loss
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> tpcds_3t_alls3_pp_ext.store_returns
</span></span><span style=display:flex><span>) salesreturnss,
</span></span><span style=display:flex><span>tpcds_3t_alls3_pp_ext.date_dim,
</span></span><span style=display:flex><span>tpcds_3t_alls3_pp_ext.store
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> date_sk <span style=color:#f92672>=</span> d_date_sk
</span></span><span style=display:flex><span><span style=color:#66d9ef>and</span> d_date <span style=color:#66d9ef>between</span> <span style=color:#66d9ef>cast</span>(<span style=color:#e6db74>&#39;1998-08-13&#39;</span> <span style=color:#66d9ef>as</span> date)
</span></span><span style=display:flex><span><span style=color:#66d9ef>and</span> (<span style=color:#66d9ef>cast</span>(<span style=color:#e6db74>&#39;1998-08-13&#39;</span> <span style=color:#66d9ef>as</span> date) <span style=color:#f92672>+</span>  <span style=color:#ae81ff>14</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>and</span> store_sk <span style=color:#f92672>=</span> s_store_sk
</span></span><span style=display:flex><span><span style=color:#66d9ef>group</span> <span style=color:#66d9ef>by</span> s_store_id
</span></span></code></pre></div><h3 id=without-bloom-filter-support-on-partition-columns>Without bloom filter support on partition columns</h3><p>The figure below is the logical query plan for the sub-query of Q05. This query appends two large fact tables: store_sales (8B rows) and store_returns (863M rows), then joins with very selective dimension tables date_dim and then with dimension table store. You can observe that the join with the date_dim table has reduced the number of rows from 9B to 93M rows.</p><p><img alt="Figure 7: Logical query plan for sub-query of Q05 without bloom filter support on partition columns" src=../../images/3-BlogsTranslated/3.2-Blog2/figure7-q05-without-bloom-filter.png></p><p><em>Figure 7: Logical query plan for sub-query of Q05 without bloom filter support on partition columns</em></p><h3 id=with-bloom-filter-support-on-partition-columns>With bloom filter support on partition columns</h3><p>With support of bloom filter on partition columns, we now create a bloom filter for the d_date_sk column of the date_dim table and push down these bloom filters to the store_sales and store_returns tables.</p><p>These bloom filters help filter out partitions in both store_sales and store_returns tables because the join occurs on the partition column (the number of partitions processed decreases by 10x).</p><p><img alt="Figure 8: Logical query plan for sub-query of Q05 with bloom filter support on partition columns" src=../../images/3-BlogsTranslated/3.2-Blog2/figure8-q05-with-bloom-filter.png></p><p><em>Figure 8: Logical query plan for sub-query of Q05 with bloom filter support on partition columns</em></p><p>Overall, the bloom filter on partition column will reduce the number of partitions processed, leading to reduced S3 listing calls and reduced number of data files that need to be read (reduction in scanned bytes). You can see that we only scan 89M rows from store_sales and 4M rows from store_returns thanks to the bloom filter. This reduction in the number of rows at the JOIN level has helped improve overall query performance by 2x and scanned bytes by 9x.</p><h2 id=conclusion>Conclusion</h2><p>In this post, we presented the new performance optimizations in Amazon Redshift data lake query processing and how AWS Glue Data Catalog statistics help enhance the quality of query plans for data lake queries in Amazon Redshift. These optimizations have significantly improved query performance, with the TPC-DS 3TB benchmark showing a 3x improvement in total execution time. Some individual queries achieved speeds up to 12x faster. We recommend using AWS Glue Data Catalog column statistics, especially for JOIN-heavy workloads, to achieve optimal query performance for your data lake queries.</p><p>In summary, Amazon Redshift now provides enhanced query performance with optimizations such as: AWS Glue Data Catalog column statistics, bloom filters on partition columns, new query rewrite rules, and faster retrieval of metadata. These optimizations are enabled by default, and Amazon Redshift users will benefit from better query response times for their workloads.</p><p>For more information, please contact your AWS technical account manager or AWS account solutions architect. They will be ready to provide additional guidance and support.</p><hr><h2 id=about-the-authors>About the Authors</h2><p><img alt="Kalaiselvi Kamaraj" src=../../images/3-BlogsTranslated/3.2-Blog2/Kalaiselvi-Kamaraj.png></p><h3 id=kalaiselvi-kamaraj>Kalaiselvi Kamaraj</h3><p>Kalaiselvi Kamaraj is a Sr. Software Development Engineer at Amazon. She has been involved in many projects in the Redshift Query Processing team and is currently focusing on performance-related projects for Redshift Data Lake.</p><p><img alt="Mark Lyons" src=../../images/3-BlogsTranslated/3.2-Blog2/Mark-Lyons.png></p><h3 id=mark-lyons>Mark Lyons</h3><p>Mark Lyons is a Principal Product Manager in the Amazon Redshift team. He works at the intersection of data lakes and data warehouses. Before joining AWS, Mark held product leadership positions at Dremio and Vertica. He is passionate about data analytics and wants to empower customers to change the world with their data.</p><p><img alt="Asser Moustafa" src=../../images/3-BlogsTranslated/3.2-Blog2/Asser-Moustafa.png></p><h3 id=asser-moustafa>Asser Moustafa</h3><p>Asser Moustafa is a Principal Worldwide Specialist Solutions Architect at AWS, based in Dallas, Texas, USA. He collaborates with customers globally, advising on all aspects of data architectures, migrations, and strategic data visions to help organizations adopt cloud-based solutions, maximize the value of their data assets, modernize legacy infrastructures, and deploy cutting-edge capabilities such as machine learning and advanced analytics. Before joining AWS, Asser held many data and analytics leadership positions, and completed an MBA at New York University and an MS in Computer Science at Columbia University, New York. He is passionate about helping organizations become truly data-driven and harnessing the transformative potential from their data.</p><p><strong>TAGS:</strong> Amazon Redshift Spectrum, Analytics, Data Lake, optimization, Performance</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=../../3-blogstranslated/3.1-blog1/ title="Blog 1"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=../../3-blogstranslated/3.3-blog3/ title="Blog 3" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=../../js/clipboard.min.js?1765261581></script><script src=../../js/perfect-scrollbar.min.js?1765261581></script><script src=../../js/perfect-scrollbar.jquery.min.js?1765261581></script><script src=../../js/jquery.sticky.js?1765261581></script><script src=../../js/featherlight.min.js?1765261581></script><script src=../../js/highlight.pack.js?1765261581></script><script>hljs.initHighlightingOnLoad()</script><script src=../../js/modernizr.custom-3.6.0.js?1765261581></script><script src=../../js/learn.js?1765261581></script><script src=../../js/hugo-learn.js?1765261581></script><link href=../../mermaid/mermaid.css?1765261581 rel=stylesheet><script src=../../mermaid/mermaid.js?1765261581></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date),(i=t.createElement(n),a=t.getElementsByTagName(n)[0]),i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>